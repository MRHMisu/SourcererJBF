# SourcererJBF:  A Java Build Framework For Large Scale Compilation

SourcererJBF or JBF is a build framework that is capable of building thousand of Java projects at scale.
JBF first takes a vast collection of Java projects as input and scrapes all the required external dependencies from
those projects or the web. Then it indexes these dependencies and compiles the projects in multiple stages. During the compilation, JBF
fixes errors and resolves external dependencies.

<img src="doc/jbf-overview.png" alt="JBF High Level Architecture"/>

### Installation

Java version: jdk8+
Ant version: any that uses javac from jdk8+
JBF is fully developed in Python and the following python packages are required to execute JBF:

* ##### [OpenJDK17](https://openjdk.java.net/projects/jdk/17/) and [Ant](https://ant.apache.org/manual/install.html)

```bash

```

* ##### Required Python Packages

JBF uses three python packages [subprocess32](), [chardet]() and [simplejson]().

```
pip install subprocess32
pip install chardet
pip install simplejson
```

### SourcererJBF Directories and Files Structure
```
ðŸ“¦ SourcererJBF
 â”£ ðŸ“‚ sourcererjbf           // The python package with scripts for building the projects.
 â”ƒ ðŸ“‚ utils                 // The utlity package with scripts for analyzing Jars and projects.
 â”ƒ ðŸ“‚ xml-templates        // The templates for creating normalized build scripts.
 â”ƒ ðŸ“‚ doc                 // Resource for project documentation.           
 ðŸ“œ jbf.config.txt       // Contains the configuration of JBF execution.
 ðŸ“œ jbf-compile.py      // Main Entry point of JBF execution
 ðŸ“œ clean-up.sh        // Script for cleaning all generated files & folders
 ðŸ“œ README.md         // JBF documentation.
```

### How To Run JBF

* ##### Edit The Configuration File

``` yml
[DEFAULT]
# The directory under which all the java projects to be compiled exist.
root = /Users/username/projects
# Rebuild the projects from scratch. Dependency rematching implies 
# that all projects might not recompile successfully.
rebuild_from_scratch = True
# The file with project paths to be build. Paths in file are considered relative to the root directory.
file = AUTOGEN
# The directory under which all the output build directories will be put.
outfolder = /Users/username/builds/
# An output file that will contain all the output information consolidated.
output = /Users/username/builds/project_details.json
# The root of the java repository
jars =/Users/username/jars
# The file that represents the mapping of fqn to jar in repository.
fqn_to_jar = /Users/username/builds/fqn-to-jars.shelve
# The number of base threads to be run.
threads = 1
try_project_build = False
verbose = True
only_project_build = False
```

* ##### Command To Execute JBF

```bash
python3 compile.py
```

### Configured and Generated Directories, Files Structure 
```
 â”£ ðŸ“‚ projects                     // All the projects that can be build. There are at most 1000 projects in each folder in projects
 â”£ ðŸ“‚ builds                      // The output of the build process. Generated following the same heirarchy that is similar to â”£ðŸ“‚ projects/
 â”£ ðŸ“‚ TBUILD                     // The python package with scripts for building the projects.
 â”ƒ ðŸ“‚ Uncompress                // Temporary folder used to unzip the project files from their zip archives.
 ðŸ“œ project_details.json       // Bookkeeping details for the projects that instruct the compilation script on how to build them.
 ðŸ“œ fqn-to-jars.shelve        // The global mapping of FQNs to jars, from our huge repository.
 ðŸ“œ *.log                    // Log files generated by worker threads in case of failures.
 ðŸ“œ save_*.shelve           // JBF documentation.
```



#### Note:
Please delete all these generated files & folders before each new run of compile.py.
```bash
./clean-up.sh
```
